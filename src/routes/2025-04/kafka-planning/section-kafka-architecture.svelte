<script>
	import Notes from '$lib/deck/notes.svelte';
	import Slide from '$lib/deck/slide.svelte';

	export let assetsDir = '';
	export let defaultBgOpacity = '0.5';
</script>

<Slide bgImage="{assetsDir}/arch_bg.jpg" bgImageOpacity={defaultBgOpacity}>
	<Slide>
		<div class="flex h-full items-center justify-center">
			<div class="text-7xl font-bold">Архитектура Kafka</div>
		</div>
		<Notes>
			Сейчас мы рассмотрим архитектуру Kafka и ее основные компоненты, чтобы лучше понимать, как она
			работает и какие преимущества предоставляет для построения распределенных систем.
		</Notes>
	</Slide>
	<Slide>
		<div class="flex flex-col items-center">
			<div class="mb-12 text-5xl font-semibold">Основные компоненты</div>
			<ul class="w-4/5 space-y-6">
				<li class="text-3xl"><strong>Кластер</strong>: Набор брокеров для хранения сообщений</li>
				<li class="text-3xl"><strong>Топики</strong>: Логические очереди событий</li>
				<li class="text-3xl"><strong>Партиции</strong>: Единицы параллелизма внутри топиков</li>
			</ul>
		</div>
		<Notes>
			Кластер Kafka — это набор узлов (брокеров), которые совместно хранят и обрабатывают сообщения.
			Топик — логическая очередь для сообщений, куда продюсеры записывают события, а консьюмеры их
			читают. Каждый топик разбит на партиции, что позволяет масштабировать обработку. Партиции
			представляют собой физические мини-очереди, которые хранят сообщения в порядке добавления
			(append-only лог). Клиенты могут параллельно читать данные из разных партиций, значительно
			увеличивая пропускную способность.
		</Notes>
	</Slide>

	<Slide>
		<div class="flex flex-col items-center">
			<div class="mb-12 text-5xl font-semibold">Продьюсеры и Консьюмеры</div>
			<div class="flex w-full justify-around">
				<div class="w-2/5">
					<div class="mb-4 text-3xl font-bold">Продьюсер</div>
					<ul class="space-y-3">
						<li class="text-2xl">Отправляет сообщения</li>
						<li class="text-2xl">Выбирает партицию</li>
						<li class="text-2xl">Настраивает надёжность</li>
					</ul>
				</div>
				<div class="w-2/5">
					<div class="mb-4 text-3xl font-bold">Консьюмер</div>
					<ul class="space-y-3">
						<li class="text-2xl">Читает сообщения</li>
						<li class="text-2xl">Работает в группах</li>
						<li class="text-2xl">Отслеживает offset</li>
					</ul>
				</div>
			</div>
		</div>
		<Notes>
			Продьюсер — приложение, отправляющее сообщения в топик. Ключевые особенности: - Может выбирать
			ключ сообщения, определяющий целевую партицию - Настраивает уровни подтверждения (acks) для
			баланса между производительностью и надёжностью - При отсутствии ключа распределяет сообщения
			между партициями по round-robin или случайно Консьюмер — приложение, читающее сообщения из
			топика: - В группе потребителей автоматически распределяет партиции между участниками - Каждая
			партиция может быть назначена только одному консьюмеру в группе - Отслеживает offset (позицию)
			в каждой партиции, позволяя возобновлять чтение с нужного места - При подтверждении offset-а
			Kafka фиксирует прогресс обработки
		</Notes>
	</Slide>

	<Slide>
		<div class="flex flex-col items-center">
			<div class="mb-12 text-5xl font-semibold">Отказоустойчивость</div>
			<ul class="w-4/5 space-y-6">
				<li class="text-3xl"><strong>Репликация</strong>: Копии данных на разных брокерах</li>
				<li class="text-3xl"><strong>Лидер/Фолловеры</strong>: Модель координации реплик</li>
				<li class="text-3xl"><strong>Автоматическое восстановление</strong> при сбоях</li>
				<li class="text-3xl">
					<strong>Retention Policy</strong>: Управление жизненным циклом данных
				</li>
			</ul>
		</div>
		<Notes>
			Репликация в Kafka — каждая партиция хранится на нескольких брокерах для обеспечения
			отказоустойчивости. Лидер обслуживает все операции чтения/записи, а фолловеры синхронизируют
			данные. Можно настроить количество синхронизированных реплик, необходимых для подтверждения
			записи. При сбое брокера фолловер автоматически становится лидером, обеспечивая непрерывность
			работы. Контроллер (выбранный брокер) координирует этот процесс. Retention policy определяет,
			как долго сообщения хранятся в системе — они удаляются по истечении настроенного времени или
			при превышении настроенного размера топика. Важно: Kafka удаляет целые сегменты партиции, а не
			отдельные сообщения, что нужно учитывать при планировании дискового пространства.
		</Notes>
	</Slide>
</Slide>
